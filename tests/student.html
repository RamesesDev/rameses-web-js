<html>
	<head>
		<link rel="stylesheet" href="js/jq_dialog/jquery-ui.custom.css"/>
		<script src="js/jquery-all.js"></script>
		<script src="js/rameses-lib.js"></script>

		<!--
		<script src="services/clfc/StudentService.js"></script>
		-->

		<style>
			table .even { background: #ddd; }
			table .odd { background: #fff; }
		</style>
		<script>
			$put( "student",

				new function() {
					this.entity = {room:"RM2"}
					this.roomList = [];

					//var studentSvc = new StudentService();
					
					this.save = function() {
						if( confirm("Save this record?") ) {
							//studentSvc.saveStudent( this.entity );
							alert( "profile data is " + $ctx('profile').name + " room " + this.entity.room );
							alert( "student successfully saved" );
							return "page2";
						}
					}

					this.init = function() {
						//this.roomList = studentSvc.getRooms();
						this.roomList = ["RM1","RM2"];
					}

					this.back = function() {  this.entity = {}; return "default"; }

					this.lookupSubject = function() {
						var d = $('#subjectLookup').load( "student/subject_popup.html" ).dialog({
							close: function() {
								$('#subjectLookup').html('');
							}
						});
						$get('subjectLookup').window = {close: function() {d.dialog("close")} };
						$ctx('subjectLookup').handler = function(o) { $ctx('profile').name = o; $get('profile').refresh(); }
					}
				},
				{
					"default":"student/studentform.html",
					page2: "student/success.html",
					form2: "student/studentform2.html"
				}
			);

			$put( "profile",
				new function() {
					this.name;
					this.fire = function() {
						//alert( "fire data for " + this.name  );
						var seed =  Math.round(Math.random()*1000);
						this.studentList.push({id: seed, firstname:"worgie "+seed, lastname:"flores"});
					}

					this.studentList = [
						{id: '001', firstname:"elmo", lastname:"nazareno", middlename: 'managase',contact:{mobile:'123456'}},
						{id: '002', firstname:"jess", lastname:"zamora"},
						{id: '003', firstname:"worgie", lastname:"flores"}
					]
					
					this.listVisible;
					
					this.toggle = function() {
						this.listVisible = !this.listVisible;
					}
				}
			);
		</script>

	</head>
	<body>
		<div context="student" loadAction="init"></div>

		Name: <input type="text" context="profile" required="true" caption="Profile name" name="name" />
		<div id="subjectLookup"></div>
		<input type="button" context="profile"  name="fire" value="Fire Name"/>
		<input type="button" context="student"  name="lookupSubject" value="Lookup Subject" immediate="true"/>

		<br/>
		<br/>
		<input type="button" context="profile" name="toggle" value="Toggle List Visibility" immediate="true"/>
		<br/>

		<table visibleWhen="${listVisible}" context="profile" items="studentList" varStatus="stat" cellpadding="3" cellspacing="0">
			<thead>
				<th>Id</th>
				<th>Contact Nos.</th>
				<th>First Name</th>
				<th>Last Name</th>
			</thead>
			<tbody>
				<tr class="${stat.index%2==0? 'even' : 'odd'}">
					<td width="50" align="center">
						<a href="view.php?id=${id}">${id}</a>
					</td>
					<td width="100" align="center" expression="${contact? contact.mobile : '(not specified)'}"></td>
					<td name="firstname"></td>
					<td name="lastname"></td>
				</tr>
			</tbody>
		</table>
		
		<br/>
		<br/>
			
		<table context="profile" visibleWhen="${listVisible}" items="studentList" varStatus="stat" cellpadding="3" cellspacing="0">
			<tbody>
				<tr class="even">
					<td colspan="2" style="border-bottom: solid 1px gray;">
						Rec. No. ${stat.index + 1}
					</td>
				</tr>
				<tr>
					<td width="50" align="center">
						<a href="view.php?id=${id}">${id}</a>
					</td>
					<td width="200">${lastname}, ${firstname} ${middlename? middlename : ''}</td>
				</tr>
			</tbody>
		</table>
	</body>

</html>
