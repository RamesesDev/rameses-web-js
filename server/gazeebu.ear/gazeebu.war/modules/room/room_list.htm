<script>
   $put( "room", 
		new function() {		
			var svc = ProxyService.lookup("RoomService");
			var name = "room";
			this.entity = {};
			this.searchParam = {};
			this.bldgList = [];
			this.statList = [{stat:"Active"},{stat:"Inactive"}];
			this.useTypeList = [{type:"Lecture"},{type:"Laboratory"},{type:"AVR"},{type:"DVD-Room"},{type:"Others"}];
			this.mode = "create";
		
			this.listModel = {
				rows:5,
				fetchList:function(p){
					p.search=$ctx(name).searchParam;					
					return svc.getList(p);
				}
			};
				
			this.onload = function() {
				this.bldgList = svc.getBldgList();
			};

			this.create = function() {
				this.entity = {};			
				this.mode="create";
				return new PopupOpener(name, "modules/room/room_form.htm", "popup" );				     				   
			};
					
			this.save = function(){			
				if(this.mode == 'create'){svc.create(this.entity);}
				else{svc.update(this.entity);}
				
				alert("Record Saved");
				this.mode = "create";			
				this.entity = {};
				this.listModel.refresh(true);
				this.onload();
				return "_close";					
			};
			
			this.edit = function(objid){  				  
				this.entity = svc.read({objid:objid});     
				this.mode = "edit";
				$get(name).navigate(new PopupOpener(name, "modules/room/room_form.htm", "popup" )) ;                                                               
			}
					
			this.delete = function(objid){
				if(confirm('Are you sure want to delete this record?')){
					svc.delete({objid:objid});						
					$get('room').refresh();   
					this.listModel.refresh(true);
				}
			}
			
			this.search=function(){
				this.searchParam = {};
				return new PopupOpener(name, "modules/room/room_search.htm", "popup"); 
			};			
			
			this.displayAll=function(){
				this.searchParam={};
				this.show();
			}
			
			this.show=function(){
				this.listModel.refresh(true);				
			};		
	})
</script>	

<input type="button" context="room" name="create" value="Add Record" />			
<input type="button" context="room" name="search" value="Search Record" />	
<input type="button" context="room" name="displayAll" value="Display Records" />

<div style="height:20px"></div>

<table class="list" context="room" model="listModel" varStatus="status"  varName="row" width="100%" cellpadding="0" cellspacing="0">
    <thead>
		<tr>    
			<th class="list-column-first">Building</th>
			<th class="list-column">Room Number</th>
			<th class="list-column">Geo Code</th>
			<th class="list-column">Room Type</th>   
			<th class="list-column">Status</th>   
			<th class="list-column-last">Actions</th>          
		</tr>
    </thead>
    <tbody>
		<tr class="#{status.index%2==0?'list-row-even':'list-row-odd'}">
			<td name="row.building"></td >
			<td  name="row.room_num"></td >
			<td  name="row.geocode"></td >			
			<td name="row.use_type"></td >
			<td  name="row.recstat"></td >
			<td colspan="2">
				<a href="#" onclick="$ctx('room').edit('#{row.objid}'); return false;"><img style="border: 0px; height:25px;" src="imgs/pics/edit.png" title="Edit"/></a>
				<a href="#" onclick="$ctx('room').delete('#{row.objid}'); return false;"><img style="border: 0px; height:25px;" src="imgs/pics/delete.png" title="Delete"/></a>
			</td>            
        </tr>
    </tbody>
</table>		

<div style="height:20px"></div>
<input type="button" value="Previous" context="room" name="listModel.movePrev" style="width:100px;">
<input type="button" value="Next" context="room" name="listModel.moveNext" style="width:100px;"> 

<div id="popup" title="Room Entry"></div>
