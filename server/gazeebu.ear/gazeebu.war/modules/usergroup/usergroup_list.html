<script type = "text/javascript">
	$put( "usergroup", 
		new function() {
			var svc = ProxyService.lookup("UserGroupService");
			var name = "usergroup";			
			this.entity = {};
			this.searchParam = {};
			this.typeList = [{type:"College/Division"},{type:"Department"}];
			this.parentList = [];//parent code --> college/division code for the drop down in case of department
			this.statList = [{stat:"Active"},{stat:"Inactive"}];
			this.mode = "create";
			
			this.listModel = {
				rows:5,
				fetchList:function(p){
					p.search = $ctx(name).searchParam;					
					return svc.getList(p);
				}
			}
			
			this.onload = function() {				
				this.parentList = svc.getParentCodeList();
			}
			
			this.create = function() {
				this.onload();
				this.entity = {};
				this.mode = "create";				      
				return new PopupOpener("modules/usergroup/usergroup_form.htm");
			}
			
			this.save = function(){
				if(this.mode == 'create'){svc.create(this.entity);}
				else{this.entity = svc.update(this.entity);}
				
				alert("Record Saved");
				this.mode = "create";
				this.entity = {};
				this.listModel.refresh(true);
				return "_close";					  
			}
			
		    this.edit = function(objid){  
				this.entity = svc.read({objid:objid});
				this.mode = "edit"; 			      
				return new PopupOpener("modules/usergroup/usergroup_form.htm"));
			}
			
			this.delete = function(objid){
				if(confirm('Are you sure want to delete this record?')){
					svc.delete({objid:objid});
					$get(name).refresh();			
					this.listModel.refresh(true);                           	    
				}
			};
			
			this.search=function(){
			        this.onload();
				this.searchParam = {};
				return new PopupOpener("modules/usergroup/usergroup_search.htm"); 
			};			
			
			this.displayAll=function(){
				this.searchParam={};
				this.show();
			};
			
			this.show=function(){
				this.listModel.refresh(true);				
			};
			
			this.showParent=function(){			
				if(this.entity.type=="Department" || this.searchParam.type=="Department"){					
					return this.parentList;
				}
				else
					return [];
			}
			
			this.showName=function(){
				return svc.getName(this.searchParam);				
			}
	});
</script>    

<input type="button" context="orgunit" name="create" value="Add Record" />			
<input type="button" context="orgunit" name="search" value="Search Record" />	
<input type="button" context="orgunit" name="displayAll" value="Display Records" />

<div style="height:20px"></div>

<table class="list" context="orgunit" model="listModel" varStatus="status" varName="row" width="100%">
    <thead>
        <tr>    
            <th class="list-column-first">Code</th>
            <th class="list-column">Name</th>
            <th class="list-column">Type</th>
			<th class="list-column">Under</th>
			<th class="list-column">Status</th>
            <th class="list-column-last">Actions</th>
        </tr>
    </thead>
    <tbody>
        <tr class="#{status.index%2==0?'list-row-even':'list-row-odd'}">			
            <td  name ="row.code"></td >
            <td  name ="row.name"></td >
            <td  name ="row.type"></td >
			<td  name ="row.parentcode"></td >
			<td  name ="row.recstat"></td >
            <td colspan="2" align="center">
				<a href="#" onclick="$ctx('orgunit').edit('#{row.objid}'); return false;"><img  style="border: 0px; height:25px;" src="imgs/pics/edit.png" title="Edit"></a>
				<a href="#" onclick="$ctx('orgunit').delete('#{row.objid}'); return false;"><img style="border: 0px; height:25px;" src="imgs/pics/delete.png" title="Delete"></a>
			</td>	 
        </tr>
    </tbody>
 </table>
 
<div style="height:20px"></div>
<input type="button" value="Previous" context="orgunit" name="listModel.movePrev" style="width:100px;">
<input type="button" value="Next" context="orgunit" name="listModel.moveNext" style="width:100px;">
 
<div id="popup" title="Organizational Units"></div>
