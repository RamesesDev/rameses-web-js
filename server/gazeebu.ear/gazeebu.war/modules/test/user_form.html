<script type="text/javascript">
	$put("userform",
		new function() {
			var svc = ProxyService.lookup( 'UserAdminService' );
			var userGroupSvc = ProxyService.lookup( 'UserGroupService' );
            var roleAdminSvc = ProxyService.lookup( 'RoleAdminService' );
                        
            this.typeList = [];
            this.roleList = [];
                       
            this.entity = {};
            this.mode = "create";
            
            this.onload = function() {
            	//alert('firing onload mode = ' + this.mode);
            };
            
            this.save = function() {
                alert('role id: ' + svc.getRoleId(this.entity));
                // create user
                this.entity = svc.create(this.entity);
                
                // create role
                this.entity.usergroup = this.entity.usergroupName;
                this.entity.userid = this.entity.objid;
                svc.createRole(this.entity);
                alert('after role');
                
                // create default login account
                alert('objid login: ' + this.entity.objid);
                this.entity = svc.createLogin(this.entity);
                
                $ctx("user").userListModel.refresh(true);                
                this.entity = {};
                alert("Record saved.");
				return "_close";
            }
            
            this.editLogin = function() {
				this.entity = this.entity;
				return "edit-login";
            }
            
            this.editRole = function() {
                this.typeList = userGroupSvc.getOrgType();
                this.roleList = roleAdminSvc.getRoleName();
                return "edit-role";
            }
            
            this.showParent = function(){			
            	if(this.entity.type != null){					
					return userGroupSvc.getOrgName({"type":this.entity.type});
				}
				else {
					return [];
				}
			}
        },
		{
			"default":"modules/user/user_form_init.html",
		 	"edit-role":"modules/user/user_role_form.html",
		 	"edit-login":"modules/user/user_login_form.html"
		}
	);
</script>
<div context="userform"></div>


